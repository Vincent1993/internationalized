# æ•°å­—æ ¼å¼åŒ–ç»„ä»¶

> åŸºäº [`Intl.NumberFormat`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat)
> çš„å¼ºå¤§æ•°å­—æ ¼å¼åŒ–ç»„ä»¶åº“ï¼Œæ”¯æŒå¤šç§æ ¼å¼åŒ–æ ·å¼ã€æ™ºèƒ½è§„åˆ™åŒ¹é…å’Œå¼‚å¸¸å€¼è‡ªåŠ¨å¤„ç†ã€‚

## ğŸ§­ é¡¹ç›®å¯¼èˆª

| æ¨¡å— | ç›®å½• | è¯´æ˜ |
|------|------|------|
| Core | `src/core` | æ ¸å¿ƒæ ¼å¼åŒ–/è§£æé€»è¾‘ã€ä¸Šä¸‹æ–‡ä¸å·¥å…·å‡½æ•° |
| Plugins | `src/plugins` | æ’ä»¶æ³¨å†Œä¸­å¿ƒåŠå†…ç½®æ’ä»¶ï¼ˆåƒåˆ†æ¯”ã€å¼‚å¸¸å›é€€ã€æ ¡éªŒã€å›ºå®šå°æ•°ä½ç­‰ï¼‰ |
| Components | `src/components` | React ç»„ä»¶å°è£…ï¼Œå« `<NumberFormat>`ã€`<AutoMetricNumber>` ç­‰ |
| Hooks | `src/hooks` | `useFormat`ã€`useParse`ã€`useAutoFormat` ç­‰ React Hook |
| FP APIs | `src/fp` | å‡½æ•°å¼è°ƒç”¨å…¥å£ï¼ˆ`formatAsCurrency`ã€`parsePercent` ç­‰ï¼‰ä¸ç¼“å­˜æœºåˆ¶ |
| Legacy | `src/legacy.ts` | å‘åå…¼å®¹çš„æ—§ç‰ˆå¯¼å‡º |
| Tests | `tests` | è¦†ç›–æ ¸å¿ƒé€»è¾‘ã€æ’ä»¶ã€ç»„ä»¶ã€E2E åœºæ™¯åŠç±»å‹å£°æ˜çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ |

### ç›®å½•ç»“æ„

```text
internationalized/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/           # æ•°å­—æ ¼å¼åŒ–æ ¸å¿ƒèƒ½åŠ›
â”‚   â”œâ”€â”€ plugins/        # æ’ä»¶ç³»ç»Ÿä¸æ‰©å±•
â”‚   â”œâ”€â”€ components/     # React ç»„ä»¶
â”‚   â”œâ”€â”€ hooks/          # React Hooks
â”‚   â”œâ”€â”€ fp/             # å‡½æ•°å¼ API
â”‚   â””â”€â”€ index.ts        # ç»Ÿä¸€å¯¼å‡ºå…¥å£
â”œâ”€â”€ tests/              # å•æµ‹ã€é›†æˆæµ‹è¯•ä¸ e2e è¦†ç›–
â”œâ”€â”€ README.mdx          # é¡¹ç›®æ–‡æ¡£ï¼ˆå½“å‰æ–‡ä»¶ï¼‰
â””â”€â”€ package.json        # åŒ…ä¿¡æ¯ä¸è„šæœ¬
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```jsonc
{
  "dependencies": {
    "@dfx/number-format": "workspace:*"
  }
}
```

### åŸºç¡€ä½¿ç”¨

```tsx pure
import { NumberFormat } from '@dfx/number-format';

// åŸºæœ¬æ•°å­—æ ¼å¼åŒ–
<NumberFormat value={1234.56} />
// è¾“å‡ºï¼š1,234.56

// è´§å¸æ ¼å¼
<NumberFormat value={1234.56} options={{ style: 'currency', currency: 'CNY' }} />
// è¾“å‡ºï¼šÂ¥1,234.56

// ç™¾åˆ†æ¯”æ ¼å¼
<NumberFormat value={0.1234} options={{ style: 'percent' }} />
// è¾“å‡ºï¼š12.34%

// åƒåˆ†æ¯”æ ¼å¼
<NumberFormat value={0.1234} options={{ style: 'per-mille' }} />
// è¾“å‡ºï¼š123.4â€°

// å›ºå®šå°æ•°ä½æ•°
<NumberFormat value={123.456789} options={{ style: 'decimal', extend_fixDecimals: 2 }} />
// è¾“å‡ºï¼š123.46
```

## ğŸ“‹ åŠŸèƒ½æ¦‚è§ˆ

### æ ¸å¿ƒåŠŸèƒ½

| åŠŸèƒ½åˆ†ç±» | ç»„ä»¶/Hook | FP å‡½æ•° | æè¿° |
|---------|----------|---------|------|
| **åŸºç¡€æ ¼å¼åŒ–** | `<NumberFormat>` | `formatAsDecimal` | æ ‡å‡†æ•°å­—æ ¼å¼åŒ–ï¼Œæ”¯æŒåƒåˆ†ä½ã€å°æ•°ä½æ§åˆ¶ |
| **è´§å¸æ ¼å¼** | `<NumberFormat style="currency">` | `formatAsCurrency` | å¤šå¸ç§æ ¼å¼åŒ–ï¼Œè‡ªåŠ¨æ·»åŠ è´§å¸ç¬¦å· |
| **ç™¾åˆ†æ¯”æ ¼å¼** | `<NumberFormat style="percent">` | `formatAsPercent` | ç™¾åˆ†æ¯”æ˜¾ç¤ºï¼Œè‡ªåŠ¨è½¬æ¢æ•°å€¼èŒƒå›´ |
| **åƒåˆ†æ¯”æ ¼å¼** | `<NumberFormat style="per-mille">` | `formatAsPerMille` | åƒåˆ†æ¯”æ˜¾ç¤ºï¼Œä½¿ç”¨ â€° ç¬¦å· |
| **å›ºå®šå°æ•°ä½æ•°** | `extend_fixDecimals` é€‰é¡¹ | æ‰©å±•é…ç½® | å¼ºåˆ¶å›ºå®šå°æ•°ä½æ•°ï¼Œè¦†ç›–ç”¨æˆ·è®¾ç½® |
| **ç´§å‡‘æ ¼å¼** | `<NumberFormat notation="compact">` | `formatAsCompact` | å¤§æ•°å€¼ç´§å‡‘æ˜¾ç¤ºï¼ˆå¦‚ 1.2Mï¼‰ |
| **ç§‘å­¦è®°æ•°æ³•** | `<NumberFormat notation="scientific">` | `formatAsScientific` | ç§‘å­¦è®°æ•°æ³•æ ¼å¼ï¼ˆå¦‚ 1.23E3ï¼‰ |
| **æ•´æ•°æ ¼å¼** | - | `formatAsInteger` | å¼ºåˆ¶æ•´æ•°æ˜¾ç¤ºï¼Œè‡ªåŠ¨å››èˆäº”å…¥ |

### è§£æåŠŸèƒ½

| åŠŸèƒ½åˆ†ç±» | Hook | FP å‡½æ•° | æè¿° |
|---------|------|---------|------|
| **åŸºç¡€è§£æ** | `useParse` | `parseDecimal` | å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²è§£æå›æ•°å­— |
| **è´§å¸è§£æ** | `useParse` | `parseCurrency` | è§£æè´§å¸æ ¼å¼å­—ç¬¦ä¸² |
| **ç™¾åˆ†æ¯”è§£æ** | `useParse` | `parsePercent` | è§£æç™¾åˆ†æ¯”æ ¼å¼å­—ç¬¦ä¸² |
| **åƒåˆ†æ¯”è§£æ** | `useParse` | `parsePerMille` | è§£æåƒåˆ†æ¯”æ ¼å¼å­—ç¬¦ä¸² |
| **æ™ºèƒ½è§£æ** | `useAutoParse` | `parseAuto` | è‡ªåŠ¨æ£€æµ‹æ ¼å¼å¹¶è§£æ |
| **è§„åˆ™åŒ¹é…è§£æ** | `useAutoParse` | - | åŸºäºè§„åˆ™è‡ªåŠ¨é€‰æ‹©è§£ææ–¹å¼ |

### é«˜çº§åŠŸèƒ½

| åŠŸèƒ½åˆ†ç±» | ç»„ä»¶/Hook | é…ç½®æ–¹å¼ | æè¿° |
|---------|----------|----------|------|
| **å…¨å±€é…ç½®** | `<NumberFormatProvider>` | Provider | åº”ç”¨çº§é»˜è®¤é…ç½®ç®¡ç† |
| **æ™ºèƒ½è§„åˆ™** | `<AutoMetricNumber>` | `rules` å±æ€§ | åŸºäºåç§°/æ­£åˆ™è‡ªåŠ¨åŒ¹é…æ ¼å¼ |
| **å¼‚å¸¸å€¼å¤„ç†** | å†…ç½®æ’ä»¶ | `registerPlugin` | å¤„ç† nullã€NaNã€Infinity ç­‰ |
| **å›ºå®šå°æ•°ä½æ•°** | `extend_fixDecimals` | æ‰©å±•é€‰é¡¹ | å¼ºåˆ¶è®¾ç½®å°æ•°ä½æ•° |
| **æ€§èƒ½ç¼“å­˜** | è‡ªåŠ¨ | `clearCache` | æ ¼å¼åŒ–å™¨å’Œè§£æå™¨è‡ªåŠ¨ç¼“å­˜ |
| **FP å…¨å±€é…ç½®** | - | `config()` | å‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„å…¨å±€é…ç½® |
| **å¤šæ€ç»„ä»¶** | `as` å±æ€§ | HTML å…ƒç´  | æ¸²æŸ“ä¸ºä¸åŒ HTML æ ‡ç­¾ |
| **å‡½æ•°å¼æ¸²æŸ“** | `children` å‡½æ•° | Render Props | è‡ªå®šä¹‰æ¸²æŸ“é€»è¾‘ |

### ç±»å‹å®‰å…¨

| ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| `UseNumberFormatResult` | æ ¼å¼åŒ–ç»“æœ | `{ formattedValue, parts, sign, isNaN }` |
| `ParseResult` | è§£æç»“æœ | `{ value, success, error, input }` |
| `MetricFormatRule` | è§„åˆ™å®šä¹‰ | `{ name: string, options: ... }` |
| `ExtendedStyle` | æ‰©å±•æ ·å¼ | `'decimal' \| 'currency' \| 'per-mille'` |

## ğŸ¯ ä½¿ç”¨åœºæ™¯å¯¹æ¯”

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|----------|------|
| ç®€å•æ•°å­—å±•ç¤º | `<NumberFormat>` | ç®€å•ç›´æ¥ï¼Œæ”¯æŒå‡½æ•°å¼æ¸²æŸ“ |
| é React ç¯å¢ƒ | `/fp` å‡½æ•°å¼ API | çº¯å‡½æ•°ï¼Œæ—  React ä¾èµ– |
| å•æ¬¡æ ¼å¼åŒ– | `/fp` å‡½æ•°å¼ API | ç®€æ´ç›´æ¥ï¼Œç±»ä¼¼ date-fns |
| å•æ¬¡è§£æ | `/fp` è§£æå‡½æ•° | å¿«é€Ÿè§£æï¼Œæ”¯æŒè‡ªåŠ¨æ£€æµ‹ |
| æ¡ä»¶æ ¼å¼åŒ– | `useFormat` Hook | çµæ´»çš„é€»è¾‘æ§åˆ¶ |
| è¡¨å•è¾“å…¥è§£æ | `useParse` Hook | é›†æˆ React çŠ¶æ€ç®¡ç† |
| æŒ‡æ ‡è‡ªåŠ¨åŒ¹é… | `<AutoMetricNumber>` | åŸºäºè§„åˆ™è‡ªåŠ¨é€‰æ‹©æ ¼å¼ |
| æŒ‡æ ‡è‡ªåŠ¨è§£æ | `useAutoParse` Hook | åŸºäºè§„åˆ™è‡ªåŠ¨è§£æè¾“å…¥ |
| æ‰¹é‡ç›¸åŒæ ¼å¼ | `useFormat` Hook | ç¼“å­˜æ ¼å¼åŒ–å™¨ï¼Œæ€§èƒ½æœ€ä¼˜ |
| æ‰¹é‡è§£æ | `/fp` è§£æå‡½æ•° | ç¼“å­˜è§£æå™¨ï¼Œæ‰¹é‡å¤„ç† |
| å¤æ‚ä¸šåŠ¡é€»è¾‘ | `useAutoFormat` Hook | æ”¯æŒè§„åˆ™é…ç½®å’Œé€»è¾‘æ§åˆ¶ |
| å…¨å±€ç»Ÿä¸€é…ç½® | `NumberFormatProvider` | ç»Ÿä¸€ç®¡ç†åº”ç”¨çš„æ ¼å¼åŒ–é…ç½® |
| FP é£æ ¼é¡¹ç›® | `/fp` + `config()` | å‡½æ•°å¼ç¼–ç¨‹ï¼Œå…¨å±€é»˜è®¤é…ç½® |
| æ•°æ®å¯¼å…¥å¯¼å‡º | `/fp` è§£æ + æ ¼å¼åŒ– | å¯é€†è½¬æ¢ï¼Œæ•°æ®ä¸€è‡´æ€§ä¿è¯ |

## ğŸ’» å¿«é€Ÿç¤ºä¾‹

### Hook ä½¿ç”¨

```tsx pure
import { useFormat, useParse } from '@dfx/number-format';

function PriceDisplay({ price }) {
  const { format } = useFormat({ style: 'currency', currency: 'USD' });
  const result = format(price);
  return <span>{result.formattedValue}</span>;
}

function PriceInput({ onChange }) {
  const { parse } = useParse({ style: 'currency', currency: 'USD' });

  const handleChange = (input) => {
    const result = parse(input);
    if (result.success) {
      onChange(result.value);
    }
  };

  return <input onChange={(e) => handleChange(e.target.value)} />;
}
```

### FP å‡½æ•°å¼ç¼–ç¨‹

```tsx pure
import {
  formatAsCurrency,
  formatAsPercent,
  parseCurrency,
  parsePercent,
  config,
} from '@dfx/number-format/fp';

// æ ¼å¼åŒ–
const price = formatAsCurrency(1234.56, 'USD'); // "$1,234.56"
const percentage = formatAsPercent(0.8765, { maximumFractionDigits: 2 }); // "87.65%"
const fixed = formatAsDecimal(123.456789, { extend_fixDecimals: 3 }); // "123.457"

// è§£æ
const currencyResult = parseCurrency("$1,234.56", "USD"); // { value: 1234.56, success: true }
const percentResult = parsePercent("12.34%"); // { value: 0.1234, success: true }

// å…¨å±€é…ç½®
config({
  percent: { maximumFractionDigits: 1 },
  currency: { minimumFractionDigits: 0 },
});
```

### æ™ºèƒ½è§„åˆ™åŒ¹é…

```tsx pure
import { AutoMetricNumber, useAutoFormat } from '@dfx/number-format';

const rules = [
  { name: 'conversion_rate', options: { style: 'percent', maximumFractionDigits: 2 } },
  { pattern: /.*_rate$/i, options: { style: 'percent' } },
  { pattern: /.*amount$/i, options: { style: 'currency', currency: 'USD' } },
];

// ç»„ä»¶æ–¹å¼
<AutoMetricNumber name="click_rate" value={0.456} rules={rules} />
// è¾“å‡ºï¼š45.6%

// Hook æ–¹å¼
function MetricCard({ metricName, value }) {
  const { format } = useAutoFormat({ name: metricName, rules });
  const result = format(value);
  return <span>{result.formattedValue}</span>;
}
```

## ğŸŒ å…¨å±€é…ç½®

### Provider é…ç½®

```tsx pure
import { NumberFormatProvider } from '@dfx/number-format';

function App() {
  return (
    <NumberFormatProvider
      options={{
        locale: 'zh-CN',
        useGrouping: true,
        rules: [
          { pattern: /.*_rate$/i, options: { style: 'percent' } },
          { pattern: /.*amount$/i, options: { style: 'currency', currency: 'CNY' } },
        ]
      }}
    >
      <NumberFormat value={1234.56} />
      {/* è¾“å‡ºï¼š1,234.56 */}
    </NumberFormatProvider>
  );
}
```

### FP å…¨å±€é…ç½®

```tsx pure
import { config, resetDefaultConfigs } from '@dfx/number-format/fp';

// è®¾ç½®å…¨å±€é»˜è®¤é…ç½®
config({
  percent: { maximumFractionDigits: 1 },
  perMille: { maximumFractionDigits: 3 },
  currency: { minimumFractionDigits: 0 },
});

// é‡ç½®é…ç½®
resetDefaultConfigs();
```

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜æœºåˆ¶

```tsx pure
import { clearCache, clearParserCache, clearAllFPCaches } from '@dfx/number-format/fp';

// æ‰¹é‡æ“ä½œ - è‡ªåŠ¨åˆ©ç”¨ç¼“å­˜
const prices = [100, 200, 300];
const formatted = prices.map(price => formatAsCurrency(price, 'USD'));
const parsed = formatted.map(str => parseCurrency(str, 'USD'));

// æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜ï¼ˆé€šå¸¸ä¸éœ€è¦ï¼‰
clearCache();          // æ¸…é™¤æ ¼å¼åŒ–å™¨ç¼“å­˜
clearParserCache();    // æ¸…é™¤è§£æå™¨ç¼“å­˜
clearAllFPCaches();    // æ¸…é™¤æ‰€æœ‰ FP ç¼“å­˜
```

### æ‰¹é‡æ ¼å¼åŒ–

```tsx pure
function MetricTable({ metrics }) {
  const { format: formatCurrency } = useFormat({
    style: 'currency',
    currency: 'USD'
  });
  const { format: formatPercent } = useFormat({
    style: 'percent'
  });

  return (
    <table>
      {metrics.map((metric) => (
        <tr key={metric.id}>
          <td>
            {metric.type === 'currency'
              ? formatCurrency(metric.value).formattedValue
              : formatPercent(metric.value).formattedValue
            }
          </td>
        </tr>
      ))}
    </table>
  );
}
```

## ğŸ”Œ æ’ä»¶ç³»ç»Ÿ

### å†…ç½®æ’ä»¶

| æ’ä»¶åç§° | åŠŸèƒ½æè¿° | ä½¿ç”¨åœºæ™¯ |
|---------|----------|----------|
| **fallback** | å¼‚å¸¸å€¼å¤„ç† | å¤„ç† nullã€NaNã€Infinity ç­‰å¼‚å¸¸å€¼ |
| **per-mille** | åƒåˆ†æ¯”æ ¼å¼ | æ”¯æŒ â€° ç¬¦å·çš„åƒåˆ†æ¯”æ˜¾ç¤º |
| **fix-decimals** | å›ºå®šå°æ•°ä½æ•° | å¼ºåˆ¶è®¾ç½®å°æ•°ä½æ•°ï¼Œè¦†ç›–ç”¨æˆ·é…ç½® |
| **validator** | é…ç½®éªŒè¯ | éªŒè¯æ ¼å¼åŒ–é€‰é¡¹çš„æœ‰æ•ˆæ€§ |

### å›ºå®šå°æ•°ä½æ•°æ’ä»¶

```tsx pure
import { NumberFormat } from '@dfx/number-format';

// åŸºç¡€ç”¨æ³• - å›ºå®š2ä½å°æ•°
<NumberFormat
  value={123.456789}
  options={{
    style: 'decimal',
    extend_fixDecimals: 2  // å¼ºåˆ¶å›ºå®šä¸º2ä½å°æ•°
  }}
/>
// è¾“å‡ºï¼š123.46

// ä¸è´§å¸ç»“åˆ
<NumberFormat
  value={123.456789}
  options={{
    style: 'currency',
    currency: 'CNY',
    extend_fixDecimals: 3  // å¼ºåˆ¶å›ºå®šä¸º3ä½å°æ•°
  }}
/>
// è¾“å‡ºï¼šÂ¥123.457

// è¦†ç›–ç”¨æˆ·é…ç½®
<NumberFormat
  value={123.456789}
  options={{
    style: 'decimal',
    maximumFractionDigits: 1,  // è¿™ä¸ªè®¾ç½®ä¼šè¢«å¿½ç•¥
    extend_fixDecimals: 4      // å®é™…ç”Ÿæ•ˆçš„é…ç½®
  }}
/>
// è¾“å‡ºï¼š123.4568
```

### å¼‚å¸¸å€¼å¤„ç†æ’ä»¶

```tsx pure
import { createFallbackPlugin, unregisterPlugin, registerPlugin } from '@dfx/number-format';

// é»˜è®¤å¼‚å¸¸å€¼å¤„ç†
<NumberFormat value={null} />              // è¾“å‡ºï¼š-
<NumberFormat value={NaN} />               // è¾“å‡ºï¼šN/A
<NumberFormat value={Infinity} />          // è¾“å‡ºï¼šâˆ

// è‡ªå®šä¹‰å¼‚å¸¸å€¼å¤„ç†
const customFallback = createFallbackPlugin({
  defaultStrategy: {
    onNull: 'æš‚æ— æ•°æ®',
    onNaN: 'æ— æ•ˆæ•°å€¼',
    onInfinity: 'æ— ç©·å¤§',
  },
  styleStrategies: [
    {
      style: 'currency',
      strategy: { onNull: '---', preserveFormatting: true },
    },
  ],
});

unregisterPlugin('fallback');
registerPlugin(customFallback);
```

### åƒåˆ†æ¯”æ’ä»¶

```tsx pure
import { NumberFormat } from '@dfx/number-format';

// åƒåˆ†æ¯”æ ¼å¼åŒ–
<NumberFormat
  value={0.1234}
  options={{
    style: 'per-mille',
    extend_fixDecimals: 2  // å¯é€‰ï¼šå›ºå®šå°æ•°ä½æ•°
  }}
/>
// è¾“å‡ºï¼š123.40â€°

// è‡ªåŠ¨å¯ç”¨ï¼Œæ— éœ€æ‰‹åŠ¨æ³¨å†Œ
```

### è‡ªå®šä¹‰æ’ä»¶å¼€å‘

```tsx pure
import { FormatPlugin } from '@dfx/number-format';

const customPlugin: FormatPlugin = {
  name: 'custom-plugin',
  version: '1.0.0',
  description: 'è‡ªå®šä¹‰æ ¼å¼åŒ–æ’ä»¶',
  priority: 50,
  phase: 'post-process', // æˆ– 'pre-process'

  isApplicable: (context) => {
    // åˆ¤æ–­æ˜¯å¦é€‚ç”¨æ­¤æ’ä»¶
    return context.style === 'decimal';
  },

  processOptions: (options) => {
    // ä¿®æ”¹æ ¼å¼åŒ–é€‰é¡¹
    return { ...options, useGrouping: false };
  },

  processResult: (formattedValue, parts) => {
    // ä¿®æ”¹æ ¼å¼åŒ–ç»“æœï¼ˆä»…åå¤„ç†é˜¶æ®µï¼‰
    return {
      formattedValue: `[${formattedValue}]`,
      parts: [{ type: 'literal', value: '[' }, ...parts, { type: 'literal', value: ']' }]
    };
  }
};

// æ³¨å†Œæ’ä»¶
registerPlugin(customPlugin);
```

## ğŸ“š API å‚è€ƒ

### ç»„ä»¶ API

```tsx pure
interface NumberFormatProps<T extends ElementType = 'span'> {
  value: number;
  options?: UseFormatOptions;
  as?: T;
  children?: (result: UseNumberFormatResult) => React.ReactNode;
}

// æ‰©å±•é€‰é¡¹æ¥å£
interface CoreExtensionOptions {
  /** æ˜¯å¦å¯ç”¨æ‰©å±•ç‰ˆçš„ç¬¦å·æ˜¾ç¤ºé€»è¾‘ï¼ˆä¼˜å…ˆäº legacy includeSignï¼‰ */
  extend_includeSign?: boolean;
  /** é›¶å€¼çš„ç¬¦å·æ˜¾ç¤ºç­–ç•¥ */
  extend_signZeroMode?: 'auto' | 'always';
  /** è´Ÿé›¶å€¼å¤„ç†ç­–ç•¥ */
  extend_negativeZero?: 'as-zero' | 'keep';
  /** å›ºå®šå°æ•°ä½æ•°ï¼ˆè‡ªåŠ¨è®¾ç½® minimumFractionDigits å’Œ maximumFractionDigits ä¸ºç›¸åŒå€¼ï¼‰ */
  extend_fixDecimals?: number;
}

interface AutoMetricNumberProps<T extends ElementType = 'span'> {
  name: string;
  value: number;
  rules?: MetricFormatRule[];
  as?: T;
}
```

### Hook API

```tsx pure
function useFormat(options?: UseFormatOptions): NumberFormatter;
function useParse(options?: UseParseOptions): UseParseResult;
function useAutoFormat(options: UseAutoFormatOptions): NumberFormatter;
function useAutoParse(options: UseAutoParseOptions): UseParseResult;
```

### FP API

```tsx pure
// æ ¼å¼åŒ–å‡½æ•°
function formatAsDecimal(value: unknown, options?: UseFormatOptions): string;
function formatAsCurrency(value: unknown, currency: string, options?: UseFormatOptions): string;
function formatAsPercent(value: unknown, options?: UseFormatOptions): string;

// è§£æå‡½æ•°
function parseDecimal(input: string, options?: ParseOptions): ParseResult;
function parseCurrency(input: string, currency: string, options?: ParseOptions): ParseResult;
function parsePercent(input: string, options?: ParseOptions): ParseResult;
function parseAuto(input: string, options?: ParseOptions): ParseResult;

// é…ç½®ç®¡ç†
function config(): FormatterDefaults;
function config(configs: Partial<FormatterDefaults>): FormatterDefaults;
function resetDefaultConfigs(): void;

// ç¼“å­˜ç®¡ç†
function clearCache(): void;
function clearParserCache(): void;
function clearAllFPCaches(): void;
```

### æ ¸å¿ƒç±»å‹

```tsx pure
interface UseNumberFormatResult {
  value: number;
  formattedValue: string;
  parts: Intl.NumberFormatPart[];
  sign: { isPositive: boolean; isNegative: boolean; isZero: boolean; numeric: 1 | -1 | 0 };
  isNaN: boolean;
}

interface ParseResult {
  value: number;
  success: boolean;
  input: string;
  error: string | null;
}

type MetricFormatRule =
  | { name: string; options: Intl.NumberFormatOptions & { style?: ExtendedStyle } }
  | { pattern: string | RegExp; options: Intl.NumberFormatOptions & { style?: ExtendedStyle } };

type ExtendedStyle = Intl.NumberFormatOptions['style'] | 'per-mille';
```

## â“ FAQ

**Q: å¼‚å¸¸å€¼å¦‚ä½•å¤„ç†ï¼Ÿ**
A: ç³»ç»Ÿé»˜è®¤å¯ç”¨ Fallback æ’ä»¶å¤„ç†å¼‚å¸¸å€¼ã€‚`null`ã€`undefined` â†’ `-`ï¼Œ`NaN` â†’ `N/A`ï¼Œ`Infinity` â†’ `âˆ`ã€‚å¯é€šè¿‡ `unregisterPlugin('fallback')` ç¦ç”¨ã€‚

**Q: è§„åˆ™åŒ¹é…ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆï¼Ÿ**
A: ç²¾ç¡® name åŒ¹é… > æ­£åˆ™ pattern åŒ¹é… > é»˜è®¤é…ç½®ã€‚å±€éƒ¨è§„åˆ™ä¼˜å…ˆçº§é«˜äºå…¨å±€è§„åˆ™ã€‚

**Q: FP é…ç½®ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆï¼Ÿ**
A: ç”¨æˆ·ä¼ å…¥é€‰é¡¹ > å…¨å±€é»˜è®¤é…ç½® > å‡½æ•°å†…ç½®é€‰é¡¹ã€‚é€šè¿‡ `config()` è®¾ç½®çš„å…¨å±€é…ç½®ä¼šå½±å“æ‰€æœ‰åç»­è°ƒç”¨ã€‚

**Q: å¦‚ä½•æå‡æ€§èƒ½ï¼Ÿ**
A: ä½¿ç”¨ Hook ç¼“å­˜æ ¼å¼åŒ–å™¨ï¼Œæ‰¹é‡ç›¸åŒæ ¼å¼æ—¶å¤ç”¨åŒä¸€ä¸ªæ ¼å¼åŒ–å™¨ã€‚FP å‡½æ•°å†…ç½®ç¼“å­˜æœºåˆ¶ï¼Œç»„ä»¶ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚å¯ä»¥é€šè¿‡ `clearCache()` æ‰‹åŠ¨æ¸…ç†ç¼“å­˜ã€‚

**Q: å¦‚ä½•å›ºå®šå°æ•°ä½æ•°ï¼Ÿ**
A: ä½¿ç”¨ `extend_fixDecimals` æ‰©å±•é€‰é¡¹ã€‚ä¾‹å¦‚ `options={{ extend_fixDecimals: 2 }}` ä¼šå¼ºåˆ¶æ˜¾ç¤º2ä½å°æ•°ï¼Œè¦†ç›–ç”¨æˆ·çš„ `minimumFractionDigits` å’Œ `maximumFractionDigits` è®¾ç½®ã€‚

**Q: æ”¯æŒå“ªäº›æ•°å­—æ ¼å¼ï¼Ÿ**
A: æ”¯æŒæ‰€æœ‰ `Intl.NumberFormat` æ ¼å¼ï¼Œé¢å¤–æ”¯æŒåƒåˆ†æ¯”ï¼ˆâ€°ï¼‰æ ¼å¼ã€‚åŒ…æ‹¬å°æ•°ã€æ•´æ•°ã€è´§å¸ã€ç™¾åˆ†æ¯”ã€ç´§å‡‘æ ¼å¼ã€ç§‘å­¦è®°æ•°æ³•ç­‰ã€‚

**Q: å¦‚ä½•å®ç°å¯é€†è½¬æ¢ï¼Ÿ**
A: ä½¿ç”¨å¯¹åº”çš„è§£æå‡½æ•°ã€‚ä¾‹å¦‚ `formatAsCurrency` å¯¹åº” `parseCurrency`ï¼Œç¡®ä¿ `parse(format(value)) === value`ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [`Intl.NumberFormat`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat) - åº•å±‚ API æ–‡æ¡£
- [`formatToParts()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/formatToParts) - æ ¼å¼åŒ–ç»“æœéƒ¨åˆ†
- [`Big.js`](https://github.com/MikeMcl/big.js/) - ç²¾ç¡®æ•°å€¼è®¡ç®—åº“

## âœ¨ ç‰¹æ€§æ€»ç»“

- **ğŸŒ å›½é™…åŒ–æ”¯æŒ**: åŸºäºæ ‡å‡† `Intl.NumberFormat` API
- **ğŸ¯ TypeScript æ”¯æŒ**: å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ™ºèƒ½æç¤º
- **âš¡ æ€§èƒ½ä¼˜åŒ–**: å†…ç½®ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤åˆ›å»ºæ ¼å¼åŒ–å™¨ï¼Œç»„ä»¶ä½¿ç”¨ React.memo
- **ğŸ”§ å‡½æ•°å¼ç¼–ç¨‹**: `/fp` å…¥å£æä¾›çº¯å‡½æ•°å¼æ ¼å¼åŒ–å‡½æ•°
- **âš™ï¸ å…¨å±€é…ç½®**: æ”¯æŒä¸ºä¸åŒæ ¼å¼ç±»å‹è®¾ç½®é»˜è®¤é€‰é¡¹
- **ğŸ”Œ æ’ä»¶ç³»ç»Ÿ**: 4ä¸ªå†…ç½®æ’ä»¶ + è‡ªå®šä¹‰æ’ä»¶æ‰©å±•æ”¯æŒ
- **ğŸ›¡ï¸ å¼‚å¸¸å€¼å¤„ç†**: å†…ç½® Fallback æ’ä»¶ï¼Œä¼˜é›…å¤„ç†å¼‚å¸¸å€¼
- **ğŸ“Š æ™ºèƒ½è§„åˆ™**: æ”¯æŒç²¾ç¡®åŒ¹é…å’Œæ­£åˆ™æ¨¡å¼çš„è‡ªåŠ¨æ ¼å¼åŒ–
- **ğŸ¨ ç»„ä»¶åŒ–è®¾è®¡**: å¤šæ€ç»„ä»¶æ”¯æŒï¼Œçµæ´»çš„æ¸²æŸ“æ–¹å¼
- **ğŸ”„ å¯é€†è§£æ**: å¼ºå¤§çš„è§£æåŠŸèƒ½ï¼Œæ”¯æŒæ ¼å¼åŒ–å­—ç¬¦ä¸²è½¬æ•°å­—
- **ğŸ“± å“åº”å¼**: ä¸ä»»ä½• UI æ¡†æ¶æ— ç¼é›†æˆ
- **ğŸ”§ æ‰©å±•é€‰é¡¹**: æ”¯æŒ `extend_fixDecimals` ç­‰é«˜çº§æ ¼å¼åŒ–æ§åˆ¶