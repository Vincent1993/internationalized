# 格式化能力

`internationalized` 基于 `Intl.NumberFormat` 并扩展了插件机制，适用于多种业务场景。

## 组件使用

> 📌 版本说明：`NumberFormat` 自 **v0.0.1** 起提供。

```tsx
import { NumberFormat } from 'internationalized';

<NumberFormat value={0.1234} style="percent" maximumFractionDigits={2} />;
```

- `style` 支持 `decimal`、`currency`、`percent` 以及扩展插件样式（如 `per-mille`、`per-myriad`、`percentage-point`、`cn-upper`）。
- 自动根据本地化规则输出千分位、货币符号和单位。

## Hook

> 📌 版本说明：`useFormat` 自 **v0.0.1** 起提供。

```tsx
import { useFormat } from 'internationalized/hooks';

const { format } = useFormat({ style: 'currency', currency: 'CNY' });
format(123456.789); // => "￥123,456.79"
```

Hook 在 React 中共享缓存配置，减少重复创建 `Intl.NumberFormat` 的开销。

## 函数式 API

```ts
import { formatAsDecimal, formatAsCurrency } from 'internationalized/fp';

formatAsDecimal(1234.567, { maximumFractionDigits: 1 });
formatAsCurrency(88.6, 'EUR');
```

函数式入口便于在非 React 环境或服务端场景使用。

> 📌 版本说明：`internationalized/fp` 下的所有函数自 **v0.0.1** 起提供。

## 日期格式化组件

`@internationalized/date-format` 包提供与数字组件同构的 API，内部基于 `date-fns` 处理输入并复用 `Intl.DateTimeFormat`。

> 📌 版本说明：`DateFormat`、`DateFormatProvider` 与 `useDateFormat` 自 **v0.0.1** 起提供。

```tsx
import { DateFormat, DateFormatProvider, useDateFormat } from '@internationalized/date-format';

function NextMeeting() {
  const formatter = useDateFormat({
    dateStyle: 'medium',
    timeStyle: 'short',
    timeZone: 'Asia/Shanghai',
  });

  const meetingDate = new Date('2024-05-20T08:00:00Z');
  const { formattedValue } = formatter.format(meetingDate);

  return <output>{formattedValue}</output>;
}

export function App() {
  return (
    <DateFormatProvider options={{ locale: 'zh-CN', timeZone: 'Asia/Shanghai' }}>
      <section>
        <h2>下一次会议</h2>
        <DateFormat value={Date.now()} dateStyle="full" timeStyle="short" />
        <NextMeeting />
      </section>
    </DateFormatProvider>
  );
}
```

## 动态小数位控制

通过 `extend_dynamicDecimals` 扩展选项，可以自动为极小的小数值提升精度，直到出现首个非零小数；若超出阈值，则回退到科学计数法：

```tsx
import { NumberFormat } from 'internationalized';

<NumberFormat
  value={0.00000031}
  style="decimal"
  extend_dynamicDecimals={{ maxFractionDigits: 8, additionalDigits: 1 }}
/>;
// => "0.00000031"
```

## 插件扩展

通过插件可以轻松扩展新的格式化模式：

```ts
import { registerNumberFormatPlugin } from 'internationalized/core';

registerNumberFormatPlugin({
  name: 'compact-metric',
  resolve({ value }) {
    if (Math.abs(value) >= 10_000) {
      return { style: 'compact', notation: 'compact' };
    }
    return null;
  }
});
```

注册后即可在组件、Hook 与函数式 API 中共享。

## API 首次支持版本速查

| API | 首次支持版本 |
| --- | --- |
| `NumberFormat` / `AutoMetricNumber` | v0.0.1 |
| `useFormat` / `useAutoFormat` / `useParse` | v0.0.1 |
| `createNumberFormat` / `resolveFormatOptions` | v0.0.1 |
| `createNumberParser` / `parseNumber` | v0.0.1 |
| `DateFormat` / `useDateFormat` / `DateFormatProvider` | v0.0.1 |

> 📚 想要以配置字符串管理格式化规则？请继续阅读[模板字符串](./templates.mdx) 章节，了解如何通过 `formatWithTemplate` 统一驱动 FP 与插件能力。
