# FP 函数参考

函数式 API 提供了与组件、Hook 同源的能力，但以纯函数形式暴露，更适用于 Node.js、服务端渲染或脚本化场景。所有函数均位于 `internationalized/fp` 入口，并默认采用 `zh-CN` 作为基础语言环境。【F:src/fp/index.ts†L1-L65】【F:src/fp/defaults.ts†L29-L95】

## 格式化函数

每个格式化函数都分为字符串版本与 `Ex` 版本（返回 `UseFormatResult`），内部通过 `mergeOptionsWithDefaults` 合并默认配置、用户参数与强制选项，再复用缓存过的核心格式化器。【F:src/fp/formatters.ts†L5-L36】【F:src/fp/formatters.ts†L44-L240】【F:src/fp/defaults.ts†L210-L229】【F:src/fp/memoize.ts†L36-L90】

| 函数 | 描述 | 默认强制项 |
|------|------|------------|
| `formatAsDecimal` / `formatAsDecimalEx` | 十进制小数，保留默认 `style: 'decimal'` | `style: 'decimal'` |
| `formatAsInteger` / `formatAsIntegerEx` | 四舍五入为整数并禁用小数位 | `style: 'decimal'`, `extend_fixDecimals: 0` |
| `formatAsCurrency` / `formatAsCurrencyEx` | 输出带货币符号的值 | `style: 'currency'`, `currency`（必填） |
| `formatAsPercent` / `formatAsPercentEx` | 百分比展示（内部倍率为 100） | `style: 'percent'` |
| `formatAsPerMille` / `formatAsPerMilleEx` | 千分比（‰） | `style: 'per-mille'` |
| `formatAsPerMyriad` / `formatAsPerMyriadEx` | 万分比（‱） | `style: 'per-myriad'` |
| `formatAsPercentagePoint` / `formatAsPercentagePointEx` | 百分点（pp） | `style: 'percentage-point'` |
| `formatAsChineseUppercase` / `formatAsChineseUppercaseEx` | 中文大写数字 | `style: 'cn-upper'` |
| `formatAsCompact` / `formatAsCompactEx` | 紧凑记数法（1.2M、1.2万） | `style: 'decimal'`, `notation: 'compact'` |
| `formatAsScientific` / `formatAsScientificEx` | 科学记数法 | `style: 'decimal'`, `notation: 'scientific'` |

> 所有函数都支持 `extend_*` 扩展选项，例如 `extend_dynamicDecimals`、`extend_includeSign` 等，用于激活对应插件。【F:src/plugins/types.ts†L218-L226】【F:src/plugins/dynamic-decimals/index.ts†L94-L182】

## 模板格式化

`formatWithTemplate` 与 `formatWithTemplateEx` 允许使用 `token|specifier` 语法描述格式化规则，并自动映射到上述函数的默认配置。详见 [模板字符串](../guide/templates.mdx) 一章。【F:src/fp/templates.ts†L246-L357】【F:src/fp/index.ts†L31-L62】

## 解析函数

解析 API 与格式化函数一一对应，同样分为基础版本与自动检测：

| 函数 | 描述 |
|------|------|
| `parseDecimal` / `parseInteger` | 解析十进制或整数表示，会自动处理千分位分隔符。【F:src/fp/parsers.ts†L28-L59】 |
| `parseCurrency` | 根据货币符号或 ISO 代码解析金额，保留数值单位。【F:src/fp/parsers.ts†L61-L82】 |
| `parsePercent` | 解析百分比字符串并转换为 0-1 之间的小数。【F:src/fp/parsers.ts†L84-L100】 |
| `parsePerMille` / `parsePerMyriad` / `parsePercentagePoint` | 解析千分比、万分比、百分点，对尾部符号进行严格校验。【F:src/fp/parsers.ts†L102-L134】 |
| `parseChineseUppercase` | 将中文大写数字还原为数值，支持负号与小数。【F:src/fp/parsers.ts†L124-L136】 |
| `parseCompact` | 解析 `1.2M`、`1.2万` 等紧凑表示法。【F:src/fp/parsers.ts†L138-L156】 |
| `parseScientific` | 解析科学记数法，保留指数信息。【F:src/fp/parsers.ts†L158-L176】 |
| `parseAuto` | 自动判定输入格式，按顺序匹配百分比、千分比、万分比、百分点、科学记数、货币、紧凑和中文大写，最后回退到十进制解析。【F:src/fp/parsers.ts†L178-L234】 |

所有解析函数最终调用同一个 `parseNumber`，并继承相同的插件与缓存机制，便于保持格式化/解析的一致性。【F:src/fp/parsers.ts†L6-L26】【F:src/fp/memoize.ts†L92-L140】

## 缓存管理

- `clearFormatterCache` / `clearParserCache` / `clearCache` / `clearAllFPCaches`：清理缓存，常用于测试或多租户场景。【F:src/fp/memoize.ts†L92-L140】
- `getFPCacheStats`（内部使用）：查看缓存命中情况，可用于调试性能瓶颈。【F:src/fp/memoize.ts†L112-L140】

## 默认配置

使用 `config()` 读取或批量更新默认选项，`resetDefaultConfigs()` 恢复初始状态。默认值在各格式类型上统一设置为 `zh-CN`，并针对货币、比例、紧凑等场景预设常用的精度。更新时遵循“默认值 < 用户传参 < 强制覆盖”的优先级顺序。【F:src/fp/defaults.ts†L6-L208】

```ts twoslash
import { config, formatAsCurrency } from 'internationalized/fp';

// 读取当前默认配置
const defaults = config();

// 全局更新货币默认货币符号与精度
config({
  currency: { currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 },
});

formatAsCurrency(1234.5, 'USD');
//=> "$1,234.50"
```

> 若需要同时控制模板默认货币或自定义 token，请结合 `configTemplates()` 与 `resetTemplateConfig()` 使用，以保持模板与直接函数调用的一致行为。【F:src/fp/templates.ts†L277-L357】
